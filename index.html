<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro Escolar</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f4f8;
      padding: 20px;
    }
    h1 { color: #2c3e50; }
    input, textarea {
      padding: 10px;
      width: 100%;
      font-size: 16px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px;
      font-size: 16px;
      margin: 5px 5px 10px 0;
    }
    ul { list-style-type: none; padding: 0; }
    li {
      background-color: #ffffff;
      margin: 5px 0;
      padding: 10px;
      border-radius: 5px;
    }
    .error { color: red; font-size: 14px; }
    .success { color: green; font-size: 14px; }
  </style>
</head>
<body>
  <h1>ğŸ“š Registro Escolar - v4.1 + RealTime</h1>

  <h2>âœ‰ï¸ Correo institucional</h2>
  <input type="email" id="emailInput" placeholder="tuemail@philips.edu.ar">
  <button onclick="validarEmail()">Validar</button>
  <p id="emailMensaje"></p>

  <div id="datosForm" style="display:none;">
    <h2>ğŸ§‘ Datos del estudiante</h2>
    <input type="text" id="nombreInput" placeholder="Nombre">
    <input type="text" id="apellidoInput" placeholder="Apellido">
    <button onclick="registrarDatos()">Registrar</button>
  </div>

  <h3>ğŸ“‹ Registros (Tiempo Real entre dispositivos)</h3>
  <ul id="registroList"></ul>
  <button onclick="eliminarRegistros()">ğŸ—‘ï¸ Eliminar todos los registros</button>
  <button onclick="exportarRegistros()">ğŸ“¤ Exportar registros</button>
  <textarea id="exportArea" rows="6" readonly style="display:none;"></textarea>

  <h3>ğŸ“¥ Importar registros:</h3>
  <textarea id="importArea" rows="6" placeholder="PegÃ¡ aquÃ­ los registros exportados..."></textarea>
  <button onclick="importarRegistros()">Importar</button>


  <!-- â–’â–’â–’â–’â–’â–’ F I R E B A S E  â–’â–’â–’â–’â–’â–’ -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>

<script>
/* âš ï¸ PEGÃ TU CONFIGURACIÃ“N AQUI */
const firebaseConfig = {
  apiKey: "",
  authDomain: "",
  databaseURL: "",
  projectId: "",
  storageBucket: "",
  messagingSenderId: "",
  appId: ""
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/

function validarEmail() {
  const email = document.getElementById('emailInput').value.trim();
  const mensaje = document.getElementById('emailMensaje');
  const dominioValido = "@philips.edu.ar";

  if (email.endsWith(dominioValido)) {
    mensaje.textContent = "Correo vÃ¡lido. Ahora completÃ¡ tus datos.";
    mensaje.className = "success";
    document.getElementById('datosForm').style.display = 'block';
  } else {
    mensaje.textContent = "Solo se permiten correos que terminen en " + dominioValido;
    mensaje.className = "error";
    document.getElementById('datosForm').style.display = 'none';
  }
}

function obtenerMateria(hora) {
  const [h, m] = hora.split(':').map(Number);
  const minutos = h * 60 + m;
  const dia = new Date().getDay();

  if (dia === 1) {
    if (minutos >= 465 && minutos < 505) return "GeografÃ­a";
    if (minutos >= 505 && minutos < 595) return "EducaciÃ³n ArtÃ­stica";
    if (minutos >= 595 && minutos < 725) return "ExpresiÃ³n Oral y Escrita";
    if (minutos >= 770 && minutos < 890) return "DiseÃ±o y Plegado";
    if (minutos >= 905 && minutos < 1020) return "DiseÃ±o y Plegado";
  }
  if (dia === 2) {
    if (minutos >= 465 && minutos < 545) return "Historia";
    if (minutos >= 555 && minutos < 675) return "InglÃ©s";
    if (minutos >= 705 && minutos < 735) return "Micro";
    if (minutos >= 735 && minutos < 855) return "EducaciÃ³n FÃ­sica";
    if (minutos >= 895 && minutos < 980) return "Lengua";
  }
  if (dia === 3) {
    if (minutos >= 465 && minutos < 635) return "Dibujo TÃ©cnico";
    if (minutos >= 645 && minutos < 685) return "TutorÃ­a";
    if (minutos >= 685 && minutos < 725) return "EducaciÃ³n ArtÃ­stica";
    if (minutos >= 730 && minutos < 810) return "MatemÃ¡tica";
    if (minutos >= 855 && minutos < 935) return "Lengua";
    if (minutos >= 940 && minutos < 980) return "Historia";
  }
  if (dia === 4) {
    if (minutos >= 465 && minutos < 545) return "GeografÃ­a";
    if (minutos >= 555 && minutos < 635) return "MatemÃ¡tica";
    if (minutos >= 645 && minutos < 725) return "ABP";
    if (minutos >= 730 && minutos < 810) return "TIC";
    if (minutos >= 855 && minutos < 935) return "CiudadanÃ­a";
  }
  if (dia === 5) {
    if (minutos >= 465 && minutos < 545) return "MatemÃ¡tica";
    if (minutos >= 555 && minutos < 635) return "BiologÃ­a";
    if (minutos >= 645 && minutos < 725) return "ProgramaciÃ³n";
    if (minutos >= 730 && minutos < 810) return "InglÃ©s";
  }
  return "Recreo";
}

function registrarDatos() {
  const email = document.getElementById('emailInput').value.trim().toLowerCase();
  const nombre = document.getElementById('nombreInput').value.trim();
  const apellido = document.getElementById('apellidoInput').value.trim();
  const fecha = new Date().toLocaleDateString('es-AR');
  const horaActual = new Date().toLocaleTimeString('es-AR', { hour12: false });
  const materia = obtenerMateria(horaActual);

  if(nombre==''||apellido=='') return;

  const id = email.replace(/\./g,"_");

  db.ref("alumnos/"+id).get().then(snap=>{
      if(snap.exists()){
          alert("âš  Este correo ya estÃ¡ registrado.");
          return;
      }
      db.ref("alumnos/"+id).set({email,nombre,apellido,materia,fecha,horaActual});
      alert("âœ” Registrado correctamente.");
  });
}

db.ref("alumnos").on("value",snap=>{
  const lista = document.getElementById('registroList');
  lista.innerHTML = "";
  snap.forEach(s=>{
      let a=s.val();
      lista.innerHTML+=`<li>${a.nombre} ${a.apellido} â€” ${a.email} â€” ${a.materia} â€” ${a.fecha} ${a.horaActual}</li>`;
  });
});

function eliminarRegistros(){
  db.ref("alumnos").remove();
  document.getElementById('registroList').innerHTML="";
}

function exportarRegistros() {
  const area = document.getElementById('exportArea');
  area.value = "";

  db.ref("alumnos").once("value",snap=>{
      snap.forEach(s=> area.value+=JSON.stringify(s.val())+"\n" );
      area.style.display="block";
      area.select();
      document.execCommand("copy");
      alert("Copiado ğŸ“¤");
  });
}

function importarRegistros(){
  const texto=document.getElementById("importArea").value.trim();
  if(!texto) return;

  const lineas=texto.split("\n");
  lineas.forEach(l=>{
    let obj=JSON.parse(l);
    let id=obj.email.replace(/\./g,"_");
    db.ref("alumnos/"+id).set(obj);
  });

  alert("ğŸ“¥ Importado con Ã©xito.");
}

</script>
</body>
</html>
