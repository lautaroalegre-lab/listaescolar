<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro Horario - Philips</title>
  <style>
    :root{--bg:#f5f7fb;--card:#fff;--accent:#2563eb;--muted:#6b7280}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#111}
    .wrap{max-width:900px;margin:32px auto;padding:20px}
    .card{background:var(--card);border-radius:10px;padding:18px;box-shadow:0 6px 20px rgba(15,23,42,0.06)}
    h1{margin:0 0 10px;font-size:20px}
    label{display:block;margin:10px 0 6px;font-size:13px;color:var(--muted)}
    input[type="text"],input[type="email"]{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-size:14px}
    button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;font-weight:600;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    .flex{display:flex;gap:10px}
    .row{display:flex;gap:10px;align-items:center}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border:1px solid #eef2f7;font-size:13px;text-align:left}
    .ok{color:green}
    .err{color:#b91c1c}
    .regs{margin-top:12px}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="mainCard">
      <h1>Registro de acceso - Philips</h1>
      <p class="muted">Ingresá tu mail institucional (@philips.edu.ar). Si es válido, te pediremos nombre y apellido y registraremos el horario con la materia correspondiente al momento.</p>

      <div id="stepEmail">
        <label for="email">Email institucional</label>
        <input id="email" type="email" placeholder="tu@philips.edu.ar" />
        <div style="height:8px"></div>
        <button id="btnCheck">Comprobar email</button>
        <p id="emailMsg" class="small"></p>
      </div>

      <div id="stepName" style="display:none">
        <label for="nombre">Nombre</label>
        <input id="nombre" type="text" placeholder="Nombre" />
        <label for="apellido">Apellido</label>
        <input id="apellido" type="text" placeholder="Apellido" />
        <div style="height:8px"></div>
        <div class="row">
          <button id="btnRegister">Registrar entrada</button>
          <div id="registerMsg" class="small"></div>
        </div>
      </div>

      <div class="regs" id="registrations">
        <h3>Registros</h3>
        <div id="regsList" class="small">No hay registros aún.</div>
      </div>

      <div style="margin-top:18px">
        <h3>Horario</h3>
        <div class="small">(La aplicación determina la materia según el día y la hora actual al registrar.)</div>
        <table>
          <thead>
            <tr><th>Día</th><th>Horario</th><th>Materia</th></tr>
          </thead>
          <tbody id="scheduleTable"></tbody>
        </table>
      </div>

    </div>
  </div>

  <script>
    // Horario definido (según lo que pediste). Horarios en formato HH:MM (24h).
    const schedule = {
      lunes: [
        ['07:45','08:25','Geografía'],
        ['08:25','09:55','Educación Artística'],
        ['09:55','12:05','Expresión Oral y Escrita'],
        ['12:50','17:00','Taller']
      ],
      martes: [
        ['07:45','09:05','Historia'],
        ['09:15','11:15','Inglés'],
        ['12:15','14:15','Educación Física'],
        ['14:55','16:20','Lengua']
      ],
      miercoles: [
        ['07:45','10:35','Dibujo Técnico'],
        ['10:45','11:25','Tutoría'],
        ['11:25','12:05','Educación Artística'],
        ['12:10','13:30','Matemática'],
        ['14:15','15:35','Lengua'],
        ['15:40','16:20','Historia']
      ],
      jueves: [
        ['07:45','09:05','Geografía'],
        ['09:15','10:35','Matemática'],
        ['10:45','12:05','ABP'],
        ['12:10','13:30','TIC'],
        ['14:15','15:35','Ciudadanía']
      ],
      viernes: [
        ['07:45','09:05','Matemática'],
        ['09:15','10:35','Biología'],
        ['10:45','12:05','Programación'],
        ['12:10','13:30','Inglés']
      ]
    };

    function pad(n){return n<10? '0'+n : ''+n}
    function timeToStr(date){return pad(date.getHours())+':'+pad(date.getMinutes())}

    // ----------------------------------
    // Rellenar tabla visual del horario
    function buildScheduleTable(){
      const tbody = document.getElementById('scheduleTable');
      tbody.innerHTML = '';
      for(const day of ['lunes','martes','miercoles','jueves','viernes']){
        const entries = schedule[day] || [];
        for(const e of entries){
          const tr = document.createElement('tr');
          const tdDay = document.createElement('td'); tdDay.textContent = capitalize(day);
          const tdTime = document.createElement('td'); tdTime.textContent = e[0] + ' - ' + e[1];
          const tdSub = document.createElement('td'); tdSub.textContent = e[2];
          tr.appendChild(tdDay); tr.appendChild(tdTime); tr.appendChild(tdSub);
          tbody.appendChild(tr);
        }
      }
    }

    function capitalize(s){return s.charAt(0).toUpperCase()+s.slice(1)}

    // ----------------------------------
    function validPhilipsEmail(email){
      if(!email) return false;
      email = email.trim().toLowerCase();
      return email.endsWith('@philips.edu.ar');
    }

    document.getElementById('btnCheck').addEventListener('click', ()=>{
      const email = document.getElementById('email').value.trim();
      const msg = document.getElementById('emailMsg');
      if(!validPhilipsEmail(email)){
        msg.textContent = 'Acceso denegado: necesitás un email @philips.edu.ar';
        msg.className = 'small err';
        return;
      }
      msg.textContent = 'Email válido. Completá tu nombre y apellido.';
      msg.className = 'small ok';
      document.getElementById('stepEmail').style.display = 'none';
      document.getElementById('stepName').style.display = 'block';
    });

    // ----------------------------------
    function getWeekdayStr(date){
      const d = date.getDay(); // 0 domingo - 6 sabado
      switch(d){
        case 1: return 'lunes';
        case 2: return 'martes';
        case 3: return 'miercoles';
        case 4: return 'jueves';
        case 5: return 'viernes';
        default: return null;
      }
    }

    function inRange(timeStr, startStr, endStr){
      // timeStr 'HH:MM'
      const [h,m] = timeStr.split(':').map(Number);
      const [hs,ms] = startStr.split(':').map(Number);
      const [he,me] = endStr.split(':').map(Number);
      const t = h*60 + m;
      const s = hs*60 + ms;
      const e = he*60 + me;
      return t >= s && t < e; // incluye inicio, excluye fin
    }

    function findSubjectAt(date){
      const day = getWeekdayStr(date);
      if(!day) return {subject: 'Fuera de horario escolar (fin de semana o día no listado)'};
      const time = timeToStr(date);
      const list = schedule[day] || [];
      for(const seg of list){
        if(inRange(time, seg[0], seg[1])) return {subject: seg[2], from: seg[0], to: seg[1], day};
      }
      return {subject: 'No hay materia en este horario (recreo/almuerzo/pausa)'};
    }

    // ----------------------------------
    const STORAGE_KEY = 'registrosHorarioPhilips';
    function loadRegs(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]') }catch(e){return []}
    }
    function saveRegs(regs){ localStorage.setItem(STORAGE_KEY, JSON.stringify(regs)) }

    function renderRegs(){
      const regs = loadRegs();
      const el = document.getElementById('regsList');
      if(!regs.length){ el.textContent = 'No hay registros aún.'; return; }
      const lines = regs.slice().reverse().map(r=>{
        return `${r.timestamp} — ${r.email} — ${r.nombre} ${r.apellido} — ${r.subject}`;
      });
      el.innerHTML = '';
      const ul = document.createElement('div');
      ul.className = 'small';
      lines.forEach(l=>{
        const d = document.createElement('div'); d.textContent = l; ul.appendChild(d);
      });
      el.appendChild(ul);
    }

    document.getElementById('btnRegister').addEventListener('click', ()=>{
      const nombre = document.getElementById('nombre').value.trim();
      const apellido = document.getElementById('apellido').value.trim();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const msg = document.getElementById('registerMsg');
      if(!nombre || !apellido){ msg.textContent = 'Completá nombre y apellido'; msg.className='small err'; return; }
      const now = new Date();
      const ts = now.toLocaleString();
      const subj = findSubjectAt(now);
      const entry = {email,nombre,apellido,timestamp:ts,subject: subj.subject};
      const regs = loadRegs(); regs.push(entry); saveRegs(regs);
      msg.textContent = `Registrado a las ${timeToStr(now)} — Materia: ${subj.subject}`;
      msg.className = 'small ok';
      renderRegs();
    });

    // inicializa
    buildScheduleTable();
    renderRegs();
  </script>
</body>
</html>
